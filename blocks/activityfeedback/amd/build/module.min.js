define ("block_activityfeedback/module",["exports","core/ajax","core/notification"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=d(b);c=d(c);function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=f(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,g=!1,h;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){g=!0;h=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(g)throw h}}}}function f(a,b){if(!a)return;if("string"==typeof a)return g(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return g(a,b)}function g(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}a.init=function init(a){h();var b=a.rootpath,c=parseInt(a.courseid);i(b,c)};function h(){document.addEventListener("click",function(a){var b=document.querySelector("div.popover_content.popover_visible");if(b!==void 0&&null!==b&&!b.contains(a.target)){var c=document.querySelectorAll("figure.block_activityfeedback_container"),d=!1,f=e(c),g;try{for(f.s();!(g=f.n()).done;){var h=g.value;if(h.contains(a.target)){d=!0;break}}}catch(a){f.e(a)}finally{f.f()}if(!d){b.classList.remove("popover_visible")}}});document.addEventListener("keyup",function(a){if(27===a.which||"Escape"===a.key||"Escape"===a.code||27===a.keyCode){var b=document.querySelector("div.popover_content.popover_visible");if(b!==void 0&&null!==b){b.classList.remove("popover_visible")}}})}function i(a,d){b.default.call([{methodname:"block_activityfeedback_get_pix_data",args:{},done:function done(b){var c=document.getElementsByClassName("activity"),f=e(c),g;try{for(f.s();!(g=f.n()).done;){var h=g.value,i=h.getElementsByClassName("activityinstance")[0];if(i!==void 0&&null!==i){var l=h.id.substring(7),n=document.createElement("figure");n.className="block_activityfeedback_container";n.setAttribute("data-cmid",l);var o=document.createElement("img");o.className="block_activityfeedback_img_main";o.src=a+"/blocks/activityfeedback/pix/feedback.png";o.alt="feedback";o.setAttribute("data-cmid",l);o.addEventListener("click",function(){j(this)});var p=document.createElement("div");p.className="popover_content";for(var q=1,r;7>=q&&q<=b.length;q++){r=document.createElement("figure");r.className="block_activityfeedback_figopt";r.setAttribute("data-cmid",l);r.setAttribute("data-fbid",b[q-1].key);r.setAttribute("data-fbname",b[q-1].name);r.addEventListener("click",function(){m(this,a)});var s=document.createElement("img");s.className="block_activityfeedback_img";s.src=b[q-1].url;s.alt=b[q-1].name;var t=document.createElement("figcaption");t.textContent=b[q-1].name;r.append(s,t);p.append(r)}n.append(o,p);i.appendChild(n)}}}catch(a){f.e(a)}finally{f.f()}k(a,d)},fail:c.default.exception}])}function j(a){var b=a.nextElementSibling;if(b.classList.contains("popover_visible")){b.classList.remove("popover_visible")}else{var c=document.querySelector("div.popover_content.popover_visible");if(c!==void 0&&null!==c){c.classList.remove("popover_visible")}b.classList.add("popover_visible")}}function k(a,d){b.default.call([{methodname:"block_activityfeedback_get_feedback_data",args:{courseid:d},done:function done(b){var c=!1,d=e(b),f;try{for(d.s();!(f=d.n()).done;){var g=f.value,h=document.querySelector("figure.block_activityfeedback_container[data-cmid=\"".concat(g.cmid,"\"]"));if(h!==void 0&&null!==h){var i=h.firstElementChild,j=h.querySelectorAll("figure.block_activityfeedback_figopt"),k=e(j),l;try{for(k.s();!(l=k.n()).done;){var m=l.value;if(m.getAttribute("data-fbid")==g.fbid){i.src=m.firstElementChild.getAttribute("src");c=!0;m.classList.remove("block_activityfeedback_not_selected");m.classList.add("block_activityfeedback_selected")}else{m.classList.remove("block_activityfeedback_selected");m.classList.add("block_activityfeedback_not_selected")}}}catch(a){k.e(a)}finally{k.f()}if(!c){i.src=a+"/blocks/activityfeedback/pix/feedback.png";c=!0}}}}catch(a){d.e(a)}finally{d.f()}},fail:c.default.exception}])}function l(a,d){b.default.call([{methodname:"block_activityfeedback_get_feedback_activity",args:{cmid:d},done:function done(b){var c=!1,f=b[0],g=document.querySelector("figure.block_activityfeedback_container[data-cmid=\"".concat(d,"\"]"));if(g!==void 0&&null!==g){var h=g.firstElementChild,i=g.querySelectorAll("figure.block_activityfeedback_figopt"),j=e(i),k;try{for(j.s();!(k=j.n()).done;){var l=k.value;if(f===void 0||null===f){l.classList.remove("block_activityfeedback_selected");l.classList.remove("block_activityfeedback_not_selected")}else if(l.getAttribute("data-fbid")==f.fbid){h.src=l.firstElementChild.getAttribute("src");c=!0;l.classList.remove("block_activityfeedback_not_selected");l.classList.add("block_activityfeedback_selected")}else{l.classList.remove("block_activityfeedback_selected");l.classList.add("block_activityfeedback_not_selected")}}}catch(a){j.e(a)}finally{j.f()}if(!c){h.src=a+"/blocks/activityfeedback/pix/feedback.png";c=!0}}},fail:c.default.exception}])}function m(a,d){var e=a.parentElement;e.classList.remove("popover_visible");var f=e.previousElementSibling;if(a.classList.contains("block_activityfeedback_selected")){f.src=d+"/blocks/activityfeedback/pix/feedback.png";a.classList.remove("block_activityfeedback_selected")}else{f.src=a.firstElementChild.getAttribute("src");a.classList.add("block_activityfeedback_selected")}var g=a.getAttribute("data-cmid"),h=a.getAttribute("data-fbid"),i=a.getAttribute("data-fbname");b.default.call([{methodname:"block_activityfeedback_set_feedback_data",args:{cmid:g,fbid:h,fbname:i},done:function done(){l(d,g)},fail:c.default.exception}])}});
//# sourceMappingURL=module.min.js.map
